name: CI and CD

on:
# Triggers the workflow on push or pull request events but only for the "main" branch
  push:
    branches:
      -main
  pull_request:
    branches:
      -main
# Allows you to run this workflow manually from the Actions tab
  workflow_dispatch:

jobs:
  cypress-run:
    runs-on: ubuntu-latest
    environment: Test
    steps:
      - name: Checkout
        uses: actions/checkout@v4
      # Install NPM dependencies, cache them correctly
      # and run all Cypress tests
      - name: Cypress run
        uses: cypress-io/github-action@v6 # use the explicit version number
        with:
          build: npm run build
          start: npm start
  deploy:
      runs-on: ubuntu-latest
      needs: cypress-run
      permissions:
          pages: write
          id-token: write
      environment:
        name: github-pages
        url: ${{steps.deployment.outputs.page_url}}
      steps:
        - name: Deploy to GitHub Pages
          id: deployment
          uses: actions/deploy-pages@v4
